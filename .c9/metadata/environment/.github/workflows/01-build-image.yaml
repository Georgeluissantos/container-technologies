{"filter":false,"title":"01-build-image.yaml","tooltip":"/.github/workflows/01-build-image.yaml","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":71,"column":0},"action":"insert","lines":["name: build-image","","on:","  push:","    branches:","      - 'main'","      - 'develop'","","jobs:","  build-image:","    runs-on: ubuntu-latest","    defaults:","      run:","        working-directory: app","    steps:","      - name: Checkout","        uses: actions/checkout@v4","","      - name: Login to Docker Hub","        uses: docker/login-action@v3","        with:","          username: ${{ secrets.DOCKERHUB_USERNAME }}","          password: ${{ secrets.DOCKERHUB_TOKEN }}","","      - name: Calculate version","        id: calculate-version","        uses: bitshifted/git-auto-semver@v1","","# https://github.com/marketplace/actions/git-automatic-semantic-versioning","      - name: Use version","        run: echo \"Calculated version:v${{ steps.calculate-version.outputs.version-string }}\"","","      - name: Set up Docker Buildx","        uses: docker/setup-buildx-action@v3","","      - name: List files","        run: ls -lha","","      - name: Build an image from Dockerfile","        env:","          DOCKER_BUILDKIT: 1","        run: |","          docker build -t ${{ secrets.DOCKERHUB_USERNAME }}/container-technologies:v${{ steps.calculate-version.outputs.version-string }} .","","      - name: Run Trivy vulnerability scanner","        uses: aquasecurity/trivy-action@master","        with:","          image-ref: '${{ secrets.DOCKERHUB_USERNAME }}/container-technologies:v${{ steps.calculate-version.outputs.version-string }}'","          format: 'table'","          exit-code: '1'","          ignore-unfixed: true","          vuln-type: 'os,library'","          severity: 'CRITICAL,HIGH'","","      - name: Push image","        run: |","          docker image push ${{ secrets.DOCKERHUB_USERNAME }}/container-technologies:v${{ steps.calculate-version.outputs.version-string }}","","      - name: Open Pull Request","        uses: devops-infra/action-pull-request@v0.5.5","        with:","          github_token: ${{ secrets.GITHUB_TOKEN }}","          source_branch: develop","          target_branch: main","          title: Automatic Pull Request","          body: \"This is an automatic pull request from the develop branch.\"","          labels: |","            - enhancement","            - auto-pr","          draft: false","          allow_no_diff: false",""],"id":1}]]},"ace":{"folds":[],"scrolltop":288,"scrollleft":0,"selection":{"start":{"row":71,"column":0},"end":{"row":71,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":21,"state":"start","mode":"ace/mode/yaml"}},"timestamp":1732935801890,"hash":"58397edc612e6a3232b3a99c01c6d98e9d0f98fa"}